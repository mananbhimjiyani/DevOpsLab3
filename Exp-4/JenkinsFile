pipeline {
    agent none
    stages {
        stage('Build') {
            agent { label 'builder' }
            steps {
                echo 'ğŸ”¨ Starting Build on Builder Agent...'
                dir('C:/Users/jay11/OneDrive/Desktop/7th sem/DevOps/DevOps Lab/DevOpsLab3/Exp-4/maven-app/demo-app') {
                    bat 'mvnd clean install'
                }
                echo 'âœ… Build Completed Successfully!'
            }
        }
        stage('Test') {
            agent { label 'tester' }
            steps {
                echo 'ğŸ§ª Running Tests on Tester Agent...'
                dir('C:/Users/jay11/OneDrive/Desktop/7th sem/DevOps/DevOps Lab/DevOpsLab3/Exp-4/maven-app/demo-app') {
                    bat 'mvnd test'
                }
                echo 'ğŸ“Š Tests Completed. Check Results Above.'
            }
        }
        stage('Run App') {
            agent { label 'tester' }   // you can run on tester or builder
            steps {
                echo 'ğŸš€ Running the Application to print output...'
                dir('C:/Users/jay11/OneDrive/Desktop/7th sem/DevOps/DevOps Lab/DevOpsLab3/Exp-4/maven-app/demo-app') {
                    // Run the Java class directly
                    bat 'java -cp target/classes com.example.App'
                }
                echo 'âœ… Application executed successfully!'
            }
        }
    }
    post {
        always {
            echo 'ğŸ Pipeline Finished (Build + Test + Run stages).'
        }
    }
}
